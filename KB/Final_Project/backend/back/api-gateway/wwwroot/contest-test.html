<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contest Service Test - ëŒ€íšŒ ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .connected { background: #d4edda; color: #155724; }
        .disconnected { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .success { background: #d1ecf1; color: #0c5460; }
        .message-log {
            height: 300px;
            border: 1px solid #ddd;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
        }
        .controls {
            margin: 10px 0;
        }
        button {
            background: #7C3AED;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #6B2DD8;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #218838;
        }
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        .btn-warning:hover {
            background: #e0a800;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .login-section {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .api-section {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .contest-section {
            background: #f3e5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .user-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .hidden {
            display: none;
        }
        .contest-item {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .contest-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .contest-meta {
            color: #666;
            font-size: 14px;
            margin: 5px 0;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }
        .pagination button {
            margin: 0 5px;
        }
        .filters {
            background: #f8f9fa;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .filter-row {
            display: flex;
            gap: 15px;
            align-items: end;
            margin-bottom: 10px;
        }
        .filter-row > div {
            flex: 1;
        }
        .json-display {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ† Contest Service Test - ëŒ€íšŒ ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸</h1>
        
        <div id="status" class="status disconnected">ë¡œê·¸ì¸ í•„ìš”</div>
        
        <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
        <div id="loginSection" class="login-section">
            <h3>ğŸ” ë¡œê·¸ì¸</h3>
            <div class="grid">
                <div>
                    <div class="form-group">
                        <label for="username">ì‚¬ìš©ìëª…:</label>
                        <input type="text" id="username" placeholder="ì‚¬ìš©ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”" />
                    </div>
                    <div class="form-group">
                        <label for="password">ë¹„ë°€ë²ˆí˜¸:</label>
                        <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
                    </div>
                    <button onclick="login()" class="btn-success">ë¡œê·¸ì¸</button>
                    <button onclick="showRegisterForm()" class="btn-success">íšŒì›ê°€ì…</button>
                </div>
                <div>
                    <h4>í…ŒìŠ¤íŠ¸ ê³„ì •:</h4>
                    <p>ì‚¬ìš©ìëª…: <code>testuser</code><br>
                    ë¹„ë°€ë²ˆí˜¸: <code>test1234</code></p>
                    <button onclick="quickLogin()" class="btn-success">í…ŒìŠ¤íŠ¸ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</button>
                </div>
            </div>
        </div>
        
        <!-- íšŒì›ê°€ì… ì„¹ì…˜ (ìˆ¨ê²¨ì ¸ ìˆìŒ) -->
        <div id="registerSection" class="login-section hidden">
            <h3>ğŸ“ íšŒì›ê°€ì…</h3>
            <div class="form-group">
                <label for="regUsername">ì‚¬ìš©ìëª…:</label>
                <input type="text" id="regUsername" placeholder="ì‚¬ìš©ìëª… (3ì ì´ìƒ)" />
            </div>
            <div class="form-group">
                <label for="regPassword">ë¹„ë°€ë²ˆí˜¸:</label>
                <input type="password" id="regPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)" />
            </div>
            <div class="form-group">
                <label for="regEmail">ì´ë©”ì¼:</label>
                <input type="email" id="regEmail" placeholder="ì´ë©”ì¼ ì£¼ì†Œ" />
            </div>
            <button onclick="register()" class="btn-success">íšŒì›ê°€ì…</button>
            <button onclick="showLoginForm()" class="btn-danger">ì·¨ì†Œ</button>
        </div>
        
        <!-- ë¡œê·¸ì¸ í›„ ì‚¬ìš©ì ì •ë³´ -->
        <div id="userSection" class="api-section hidden">
            <h3>ğŸ‘¤ ì‚¬ìš©ì ì •ë³´</h3>
            <div id="userInfo" class="user-info"></div>
            <button onclick="logout()" class="btn-danger">ë¡œê·¸ì•„ì›ƒ</button>
            <button onclick="verifyToken()">í† í° ê²€ì¦</button>
        </div>
        
        <!-- Contest API í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
        <div id="contestSection" class="hidden">
            <!-- í•„í„° ì„¹ì…˜ -->
            <div class="contest-section">
                <h3>ğŸ” ëŒ€íšŒ ëª©ë¡ í•„í„°</h3>
                <div class="filters">
                    <div class="filter-row">

                        <div>
                            <label for="categoryFilter">ì¹´í…Œê³ ë¦¬ ID:</label>
                            <input type="number" id="categoryFilter" placeholder="ì¹´í…Œê³ ë¦¬ ID (1:IT, 2:ë””ìì¸, 4:ì°½ì—…, 5:ê³¼í•™, 7:ì‚¬íšŒê³µí—Œ)" />
                        </div>
                        <div>
                            <label for="keywordFilter">í‚¤ì›Œë“œ:</label>
                            <input type="text" id="keywordFilter" placeholder="ì œëª©, ì„¤ëª…, ì£¼ìµœì ê²€ìƒ‰" />
                        </div>
                        <div>
                            <label>&nbsp;</label>
                            <button onclick="loadContests()" class="btn-success">ëŒ€íšŒ ëª©ë¡ ì¡°íšŒ</button>
                        </div>
                    </div>
                    <div class="filter-row">
                        <div>
                            <label for="pageSize">í˜ì´ì§€ í¬ê¸°:</label>
                            <select id="pageSize">
                                <option value="5">5ê°œ</option>
                                <option value="10" selected>10ê°œ</option>
                                <option value="20">20ê°œ</option>
                                <option value="50">50ê°œ</option>
                            </select>
                        </div>
                        <div>
                            <label for="sortBy">ì •ë ¬ ê¸°ì¤€:</label>
                            <select id="sortBy">
                                <option value="createdAt">ìƒì„±ì¼ì</option>
                                <option value="title">ì œëª©</option>
                                <option value="startDate">ì‹œì‘ì¼</option>
                                <option value="applicationDeadline">ë§ˆê°ì¼</option>
                            </select>
                        </div>
                        <div>
                            <label for="sortDir">ì •ë ¬ ë°©í–¥:</label>
                            <select id="sortDir">
                                <option value="desc" selected>ë‚´ë¦¼ì°¨ìˆœ</option>
                                <option value="asc">ì˜¤ë¦„ì°¨ìˆœ</option>
                            </select>
                        </div>
                        <div>
                            <label>&nbsp;</label>
                            <button onclick="clearFilters()" class="btn-warning">í•„í„° ì´ˆê¸°í™”</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- API í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ -->
            <div class="api-section">
                <h3>ğŸ§ª API í…ŒìŠ¤íŠ¸</h3>
                <div class="controls">
                    <button onclick="testContestService()" class="btn-success">Contest Service ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                    <button onclick="loadContests()">ëŒ€íšŒ ëª©ë¡ ì¡°íšŒ</button>
                    <button onclick="testGetContestById()" class="btn-warning">íŠ¹ì • ëŒ€íšŒ ì¡°íšŒ í…ŒìŠ¤íŠ¸</button>
                    <button onclick="clearLog()">ë¡œê·¸ í´ë¦¬ì–´</button>
                </div>
                
                <div class="form-group">
                    <label for="contestIdInput">ëŒ€íšŒ ID (ìƒì„¸ ì¡°íšŒìš©):</label>
                    <input type="text" id="contestIdInput" placeholder="ëŒ€íšŒ IDë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 10000000-0000-0000-0000-000000000001)" />
                    <button onclick="getContestById()">ëŒ€íšŒ ìƒì„¸ ì¡°íšŒ</button>
                </div>
            </div>
            
            <!-- ëŒ€íšŒ ëª©ë¡ í‘œì‹œ -->
            <div class="contest-section">
                <h3>ğŸ“‹ ëŒ€íšŒ ëª©ë¡</h3>
                <div id="contestList"></div>
                
                <!-- í˜ì´ì§• ì»¨íŠ¸ë¡¤ -->
                <div id="paginationControls" class="pagination hidden">
                    <button onclick="goToPage(currentPage - 1)">ì´ì „</button>
                    <span id="pageInfo">í˜ì´ì§€ ì •ë³´</span>
                    <button onclick="goToPage(currentPage + 1)">ë‹¤ìŒ</button>
                </div>
            </div>
            
            <!-- JSON ì‘ë‹µ í‘œì‹œ -->
            <div class="api-section">
                <h3>ğŸ“„ ìµœê·¼ API ì‘ë‹µ (JSON)</h3>
                <div id="jsonResponse" class="json-display">API í˜¸ì¶œ í›„ ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
            </div>
            
            <!-- ë¡œê·¸ í‘œì‹œ -->
            <div class="api-section">
                <h3>ğŸ“‹ API í˜¸ì¶œ ë¡œê·¸</h3>
                <div id="messageLog" class="message-log"></div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let currentPage = 0;
        let totalPages = 0;
        let lastContestData = null;
        
        // API ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •
        const AUTH_SERVER_URL = 'http://localhost:60000';
        const API_GATEWAY_URL = 'http://localhost:8080';
        
        // ë¡œê·¸ì¸ í•¨ìˆ˜
        async function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                log('ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            try {
                log('ë¡œê·¸ì¸ ì‹œë„ ì¤‘...');
                const response = await fetch(`${AUTH_SERVER_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        username: username,
                        password: password
                    })
                });
                
                const result = await response.text();
                
                if (response.ok) {
                    log('ë¡œê·¸ì¸ ì„±ê³µ!');
                    try {
                        const data = JSON.parse(result);
                        currentUser = data.user;
                    } catch (e) {
                        currentUser = { username: username };
                    }
                    showUserSection();
                    updateStatus('ë¡œê·¸ì¸ ì™„ë£Œ - Contest API í…ŒìŠ¤íŠ¸ ê°€ëŠ¥', 'success');
                } else {
                    log('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + result);
                    updateStatus('ë¡œê·¸ì¸ ì‹¤íŒ¨', 'disconnected');
                }
            } catch (error) {
                log('ë¡œê·¸ì¸ ì—ëŸ¬: ' + error.message);
                updateStatus('ë¡œê·¸ì¸ ì—ëŸ¬', 'disconnected');
            }
        }
        
        // í…ŒìŠ¤íŠ¸ ê³„ì • ë¡œê·¸ì¸
        async function quickLogin() {
            document.getElementById('username').value = 'testuser';
            document.getElementById('password').value = 'test1234';
            await login();
        }
        
        // íšŒì›ê°€ì… í•¨ìˆ˜
        async function register() {
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            
            if (!username || !password || !email) {
                log('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            try {
                log('íšŒì›ê°€ì… ì‹œë„ ì¤‘...');
                const response = await fetch(`${AUTH_SERVER_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password,
                        email: email
                    })
                });
                
                const result = await response.text();
                
                if (response.ok) {
                    log('íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    showLoginForm();
                    document.getElementById('username').value = username;
                } else {
                    log('íšŒì›ê°€ì… ì‹¤íŒ¨: ' + result);
                }
            } catch (error) {
                log('íšŒì›ê°€ì… ì—ëŸ¬: ' + error.message);
            }
        }
        
        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        async function logout() {
            try {
                log('ë¡œê·¸ì•„ì›ƒ ì‹œë„ ì¤‘...');
                
                const response = await fetch(`${AUTH_SERVER_URL}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                if (response.ok) {
                    log('ë¡œê·¸ì•„ì›ƒ ì„±ê³µ');
                } else {
                    log('ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
                }
            } catch (error) {
                log('ë¡œê·¸ì•„ì›ƒ ì—ëŸ¬: ' + error.message);
            }
            
            currentUser = null;
            showLoginForm();
            updateStatus('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ', 'disconnected');
        }
        
        // í† í° ê²€ì¦ í•¨ìˆ˜
        async function verifyToken() {
            try {
                log('í† í° ê²€ì¦ ì¤‘...');
                const response = await fetch(`${AUTH_SERVER_URL}/auth/verify`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const result = await response.text();
                
                if (response.ok) {
                    try {
                        const data = JSON.parse(result);
                        if (data.valid) {
                            log('í† í° ê²€ì¦ ì„±ê³µ: ' + JSON.stringify(data.user));
                            updateStatus('í† í° ìœ íš¨', 'success');
                        } else {
                            log('í† í° ê²€ì¦ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                            updateStatus('í† í° ë¬´íš¨ - ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”', 'disconnected');
                            showLoginForm();
                        }
                    } catch (e) {
                        log('í† í° ê²€ì¦ ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨: ' + result);
                        updateStatus('í† í° ê²€ì¦ ì˜¤ë¥˜', 'disconnected');
                    }
                } else {
                    log('í† í° ê²€ì¦ ì‹¤íŒ¨: ' + result);
                    updateStatus('í† í° ë¬´íš¨ - ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”', 'disconnected');
                    showLoginForm();
                }
            } catch (error) {
                log('í† í° ê²€ì¦ ì—ëŸ¬: ' + error.message);
                updateStatus('í† í° ê²€ì¦ ì—ëŸ¬', 'disconnected');
            }
        }
        
        // Contest Service ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testContestService() {
            try {
                log('Contest Service ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...');
                const response = await fetch(`${API_GATEWAY_URL}/api/contests/test`, {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const result = await response.text();
                
                if (response.ok) {
                    log('âœ… Contest Service ì—°ê²° ì„±ê³µ: ' + result);
                    updateStatus('Contest Service ì—°ê²°ë¨', 'success');
                } else {
                    log('âŒ Contest Service ì—°ê²° ì‹¤íŒ¨: ' + result);
                    updateStatus('Contest Service ì—°ê²° ì‹¤íŒ¨', 'warning');
                }
            } catch (error) {
                log('âŒ Contest Service ì—°ê²° ì—ëŸ¬: ' + error.message);
                updateStatus('Contest Service ì—°ê²° ì—ëŸ¬', 'disconnected');
            }
        }
        
        // ëŒ€íšŒ ëª©ë¡ ì¡°íšŒ
        async function loadContests() {
            if (!currentUser) {
                log('ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”');
                return;
            }
            
            try {
                // í•„í„° ê°’ë“¤ ê°€ì ¸ì˜¤ê¸°
                const category = document.getElementById('categoryFilter').value;
                const keyword = document.getElementById('keywordFilter').value;
                const pageSize = document.getElementById('pageSize').value;
                const sortBy = document.getElementById('sortBy').value;
                const sortDir = document.getElementById('sortDir').value;
                
                // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° êµ¬ì„±
                const params = new URLSearchParams();
                params.append('page', currentPage);
                params.append('size', pageSize);
                params.append('sortBy', sortBy);
                params.append('sortDir', sortDir);
                
                if (category) params.append('category', category);
                if (keyword) params.append('keyword', keyword);
                
                const url = `${API_GATEWAY_URL}/api/contests?${params.toString()}`;
                log(`ëŒ€íšŒ ëª©ë¡ ì¡°íšŒ ì¤‘... ${url}`);
                
                const response = await fetch(url, {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const result = await response.text();
                
                if (response.ok) {
                    const data = JSON.parse(result);
                    lastContestData = data;
                    totalPages = data.totalPages;
                    
                    log(`âœ… ëŒ€íšŒ ëª©ë¡ ì¡°íšŒ ì„±ê³µ: ${data.totalElements}ê°œ ëŒ€íšŒ found`);
                    displayContests(data);
                    displayJsonResponse(result);
                    updatePagination();
                    updateStatus(`ëŒ€íšŒ ëª©ë¡ ì¡°íšŒ ì™„ë£Œ (í˜ì´ì§€ ${currentPage + 1}/${totalPages})`, 'success');
                } else {
                    log('âŒ ëŒ€íšŒ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ' + result);
                    updateStatus('ëŒ€íšŒ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨', 'warning');
                }
            } catch (error) {
                log('âŒ ëŒ€íšŒ ëª©ë¡ ì¡°íšŒ ì—ëŸ¬: ' + error.message);
                updateStatus('ëŒ€íšŒ ëª©ë¡ ì¡°íšŒ ì—ëŸ¬', 'disconnected');
            }
        }
        
        // íŠ¹ì • ëŒ€íšŒ ìƒì„¸ ì¡°íšŒ
        async function getContestById() {
            const contestId = document.getElementById('contestIdInput').value.trim();
            
            if (!contestId) {
                log('ëŒ€íšŒ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            try {
                log(`ëŒ€íšŒ ìƒì„¸ ì¡°íšŒ ì¤‘... ID: ${contestId}`);
                const response = await fetch(`${API_GATEWAY_URL}/api/contests/${contestId}`, {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const result = await response.text();
                
                if (response.ok) {
                    const data = JSON.parse(result);
                    log(`âœ… ëŒ€íšŒ ìƒì„¸ ì¡°íšŒ ì„±ê³µ: ${data.title}`);
                    displaySingleContest(data);
                    displayJsonResponse(result);
                    updateStatus(`ëŒ€íšŒ ìƒì„¸ ì¡°íšŒ ì™„ë£Œ: ${data.title}`, 'success');
                } else {
                    log('âŒ ëŒ€íšŒ ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨: ' + result);
                    updateStatus('ëŒ€íšŒ ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨', 'warning');
                }
            } catch (error) {
                log('âŒ ëŒ€íšŒ ìƒì„¸ ì¡°íšŒ ì—ëŸ¬: ' + error.message);
                updateStatus('ëŒ€íšŒ ìƒì„¸ ì¡°íšŒ ì—ëŸ¬', 'disconnected');
            }
        }
        
        // í…ŒìŠ¤íŠ¸ìš© ëŒ€íšŒ ìƒì„¸ ì¡°íšŒ
        async function testGetContestById() {
            document.getElementById('contestIdInput').value = '00000000-0000-0000-0000-000000000001';
            await getContestById();
        }
        
        // ëŒ€íšŒ ëª©ë¡ í‘œì‹œ
        function displayContests(data) {
            const contestList = document.getElementById('contestList');
            
            if (!data.content || data.content.length === 0) {
                contestList.innerHTML = '<p>ì¡°íšŒëœ ëŒ€íšŒê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '';
            data.content.forEach(contest => {
                const categoriesText = contest.categories ? contest.categories.map(cat => cat.name).join(', ') : 'ì¹´í…Œê³ ë¦¬ ì—†ìŒ';
                html += `
                    <div class="contest-item">
                        <div class="contest-title">${contest.title}</div>
                        <div class="contest-meta">
                            ì£¼ìµœ: ${contest.organizer} | 
                            í™œì„±: ${contest.isActive ? 'âœ…' : 'âŒ'}
                        </div>
                        <div class="contest-meta">
                            ğŸ“… ${contest.startDate.split('T')[0]} ~ ${contest.endDate.split('T')[0]} | 
                            â° ë§ˆê°: ${contest.registrationDeadline ? contest.registrationDeadline.split('T')[0] : 'ë¯¸ì •'}
                        </div>
                        <div class="contest-meta">
                            ${contest.description ? contest.description.substring(0, 100) + '...' : 'ì„¤ëª… ì—†ìŒ'}
                        </div>
                        <div class="contest-meta">ğŸ“‚ ì¹´í…Œê³ ë¦¬: ${categoriesText}</div>
                        <div class="contest-meta">
                            <button onclick="showContestDetails('${contest.id}')" class="btn-success">ìƒì„¸ë³´ê¸°</button>
                        </div>
                    </div>
                `;
            });
            
            contestList.innerHTML = html;
        }
        
        // ë‹¨ì¼ ëŒ€íšŒ í‘œì‹œ
        function displaySingleContest(contest) {
            const contestList = document.getElementById('contestList');
            const categoriesText = contest.categories ? contest.categories.map(cat => cat.name).join(', ') : 'ì¹´í…Œê³ ë¦¬ ì—†ìŒ';
            
            contestList.innerHTML = `
                <div class="contest-item">
                    <div class="contest-title">${contest.title}</div>
                    <div class="contest-meta">
                        ì£¼ìµœ: ${contest.organizer} | 
                        í™œì„±: ${contest.isActive ? 'âœ… í™œì„±' : 'âŒ ë¹„í™œì„±'}
                    </div>
                    <div class="contest-meta">
                        ğŸ“… ì‹œì‘ì¼: ${contest.startDate.split('T')[0]} | ì¢…ë£Œì¼: ${contest.endDate.split('T')[0]}
                    </div>
                    <div class="contest-meta">
                        â° ì‹ ì²­ ë§ˆê°: ${contest.registrationDeadline ? contest.registrationDeadline.split('T')[0] : 'ë¯¸ì •'}
                    </div>
                    ${contest.websiteUrl ? `<div class="contest-meta">ğŸŒ ì›¹ì‚¬ì´íŠ¸: <a href="${contest.websiteUrl}" target="_blank">${contest.websiteUrl}</a></div>` : ''}
                    <div class="contest-meta">ğŸ“‚ ì¹´í…Œê³ ë¦¬: ${categoriesText}</div>
                    <div class="contest-meta">${contest.description || 'ì„¤ëª… ì—†ìŒ'}</div>
                    ${contest.prizeDescription ? `<div class="contest-meta">ğŸ† ìƒê¸ˆ/í˜œíƒ: ${contest.prizeDescription}</div>` : ''}
                    ${contest.requirements ? `<div class="contest-meta">ğŸ“‹ ì°¸ê°€ ìš”ê±´: ${contest.requirements}</div>` : ''}
                    ${contest.imageUrl ? `<div class="contest-meta">ğŸ–¼ï¸ ì´ë¯¸ì§€: <a href="${contest.imageUrl}" target="_blank">ë³´ê¸°</a></div>` : ''}
                </div>
            `;
        }
        
        // ëŒ€íšŒ ìƒì„¸ë³´ê¸°
        function showContestDetails(contestId) {
            document.getElementById('contestIdInput').value = contestId;
            getContestById();
        }
        

        
        // í˜ì´ì§• ì²˜ë¦¬
        function goToPage(page) {
            if (page < 0 || page >= totalPages) return;
            currentPage = page;
            loadContests();
        }
        
        function updatePagination() {
            const paginationControls = document.getElementById('paginationControls');
            const pageInfo = document.getElementById('pageInfo');
            
            if (totalPages > 1) {
                paginationControls.classList.remove('hidden');
                pageInfo.textContent = `${currentPage + 1} / ${totalPages}`;
            } else {
                paginationControls.classList.add('hidden');
            }
        }
        
        // í•„í„° ì´ˆê¸°í™”
        function clearFilters() {
            document.getElementById('categoryFilter').value = '';
            document.getElementById('keywordFilter').value = '';
            document.getElementById('pageSize').value = '10';
            document.getElementById('sortBy').value = 'createdAt';
            document.getElementById('sortDir').value = 'desc';
            currentPage = 0;
            log('í•„í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
        }
        
        // JSON ì‘ë‹µ í‘œì‹œ
        function displayJsonResponse(jsonString) {
            const jsonResponse = document.getElementById('jsonResponse');
            try {
                const formatted = JSON.stringify(JSON.parse(jsonString), null, 2);
                jsonResponse.textContent = formatted;
            } catch (e) {
                jsonResponse.textContent = jsonString;
            }
        }
        
        // UI ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function showLoginForm() {
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('registerSection').classList.add('hidden');
            document.getElementById('userSection').classList.add('hidden');
            document.getElementById('contestSection').classList.add('hidden');
        }
        
        function showRegisterForm() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('registerSection').classList.remove('hidden');
        }
        
        function showUserSection() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('registerSection').classList.add('hidden');
            document.getElementById('userSection').classList.remove('hidden');
            document.getElementById('contestSection').classList.remove('hidden');
            
            if (currentUser) {
                document.getElementById('userInfo').innerHTML = `
                    <strong>ID:</strong> ${currentUser.id || 'N/A'}<br>
                    <strong>ì‚¬ìš©ìëª…:</strong> ${currentUser.username}<br>
                    <strong>ì´ë©”ì¼:</strong> ${currentUser.email || 'N/A'}
                `;
            }
        }
        
        function updateStatus(text, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = text;
            statusEl.className = `status ${type}`;
        }
        
        function log(message) {
            const logEl = document.getElementById('messageLog');
            const timestamp = new Date().toLocaleTimeString();
            logEl.innerHTML += `[${timestamp}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('messageLog').innerHTML = '';
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° í™•ì¸
        window.onload = async function() {
            log('Contest Service í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            
            try {
                const response = await fetch(`${AUTH_SERVER_URL}/auth/verify`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const result = await response.text();
                
                if (response.ok) {
                    try {
                        const data = JSON.parse(result);
                        if (data.valid) {
                            log('ê¸°ì¡´ ë¡œê·¸ì¸ ì„¸ì…˜ ë°œê²¬');
                            currentUser = data.user;
                            showUserSection();
                            updateStatus('ë¡œê·¸ì¸ ìƒíƒœ - Contest API í…ŒìŠ¤íŠ¸ ê°€ëŠ¥', 'success');
                            
                            // ìë™ìœ¼ë¡œ ëŒ€íšŒ ëª©ë¡ ë¡œë“œ
                            setTimeout(() => {
                                loadContests();
                            }, 1000);
                        } else {
                            log('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
                            showLoginForm();
                        }
                    } catch (e) {
                        log('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
                        showLoginForm();
                    }
                } else {
                    log('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤');
                    showLoginForm();
                }
            } catch (error) {
                log('ì„¸ì…˜ í™•ì¸ ì¤‘ ì˜¤ë¥˜: ' + error.message);
                showLoginForm();
            }
        };
        
        // Enter í‚¤ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                const target = event.target;
                
                if (target.id === 'password') {
                    login();
                } else if (target.id === 'regEmail') {
                    register();
                } else if (target.id === 'contestIdInput') {
                    getContestById();
                } else if (target.id === 'keywordFilter') {
                    loadContests();
                }
            }
        });
    </script>
</body>
</html> 